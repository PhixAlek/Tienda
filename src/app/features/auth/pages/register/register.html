<div class="register-container">
  <button class="back-btn" (click)="goBack()">
    <mat-icon>arrow_back</mat-icon> Volver
  </button>

  @if (step === 'choose') {
    <h1 class="choose-title">¿Qué tipo de cuenta vas a crear?</h1>
    <div class="choose">
      <button (click)="select('user')">Usuario</button>
      <button (click)="select('admin')">Administrador</button>
    </div>
  }

  @else if (step === 'user') {
    <div class="register-card">
      <h1>Registro de Usuario</h1>
      <form #fUser="ngForm" (ngSubmit)="submit(fUser)">
        <div class="form-group">
          <label>Nombre completo</label>
          <input
            name="nombre"
            [(ngModel)]="nombre"
            required
            minlength="2"
            #nombreCtrl="ngModel"
          />
          @if (nombreCtrl.invalid && nombreCtrl.touched) {
            <small class="error">
              @if (nombreCtrl.errors?.['required']) { El nombre es obligatorio. }
              @else if (nombreCtrl.errors?.['minlength']) { Debe tener al menos 2 caracteres. }
            </small>
          }
        </div>

        <div class="form-group">
          <label>Correo electrónico</label>
          <input
            name="email"
            type="email"
            [(ngModel)]="email"
            required
            email
            #emailCtrl="ngModel"
          />
          @if (emailCtrl.invalid && emailCtrl.touched) {
            <small class="error">
              @if (emailCtrl.errors?.['required']) { El correo es obligatorio. }
              @else if (emailCtrl.errors?.['email']) { Formato de correo inválido. }
            </small>
          }
        </div>

        <div class="form-group">
          <label>Contraseña</label>
          <input
            name="password"
            type="password"
            [(ngModel)]="password"
            required
            minlength="8"
            #passwordCtrl="ngModel"
          />
          @if (passwordCtrl.invalid && passwordCtrl.touched) {
            <small class="error">
              @if (passwordCtrl.errors?.['required']) { La contraseña es obligatoria. }
              @else if (passwordCtrl.errors?.['minlength']) { Debe tener al menos 8 caracteres. }
            </small>
          }
        </div>

        <div class="form-group">
          <label>Edad (opcional)</label>
          <input name="edad" type="number" [(ngModel)]="edad" min="0" />
        </div>

        <div class="form-group">
          <label>Teléfono (opcional)</label>
          <input name="telefono" [(ngModel)]="telefono" />
        </div>

        <div class="form-group">
          <label>Dirección (opcional)</label>
          <input name="direccion" [(ngModel)]="direccion" />
        </div>

        <button type="submit" [disabled]="fUser.invalid || loading">
          @if (loading) {
            <mat-spinner diameter="20"></mat-spinner> Creando cuenta...
          } @else {
            Crear cuenta
          }
        </button>
      </form>
    </div>
  }

  @else if (step === 'admin') {
    <div class="register-card">
      <h1>Registro de Administrador</h1>
      <form #fAdmin="ngForm" (ngSubmit)="submit(fAdmin)">
        <div class="form-group">
          <label>Nombre</label>
          <input
            name="nombre"
            [(ngModel)]="nombre"
            required
            minlength="2"
            #nombreA="ngModel"
          />
          @if (nombreA.invalid && nombreA.touched) {
            <small class="error">
              @if (nombreA.errors?.['required']) { El nombre es obligatorio. }
              @else if (nombreA.errors?.['minlength']) { Debe tener al menos 2 caracteres. }
            </small>
          }
        </div>

        <div class="form-group">
          <label>Correo electrónico</label>
          <input
            name="email"
            type="email"
            [(ngModel)]="email"
            required
            email
            #emailA="ngModel"
          />
          @if (emailA.invalid && emailA.touched) {
            <small class="error">
              @if (emailA.errors?.['required']) { El correo es obligatorio. }
              @else if (emailA.errors?.['email']) { Formato de correo inválido. }
            </small>
          }
        </div>

        <div class="form-group">
          <label>Contraseña</label>
          <input
            name="password"
            type="password"
            [(ngModel)]="password"
            required
            minlength="8"
            #passwordA="ngModel"
          />
          @if (passwordA.invalid && passwordA.touched) {
            <small class="error">
              @if (passwordA.errors?.['required']) { La contraseña es obligatoria. }
              @else if (passwordA.errors?.['minlength']) { Debe tener al menos 8 caracteres. }
            </small>
          }
        </div>

        <button type="submit" [disabled]="fAdmin.invalid || loading">
          @if (loading) {
            <mat-spinner diameter="20"></mat-spinner> Creando administrador...
          } @else {
            Crear administrador
          }
        </button>
      </form>
    </div>
  }
</div>
